name: WireGuard Test

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ§° Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° WireGuard
        run: |
          sudo apt update
          sudo apt install -y wireguard curl

      - name: ðŸ“ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
        run: |
          sudo tee /etc/wireguard/wg0.conf > /dev/null <<EOF
[Interface]
PrivateKey = gAyGrUttLdgh+ENPy7os9vFLycJgn6PC3XuANg6RAWg=
Address = 10.1.0.2/32
DNS = 1.1.1.1

[Peer]
PublicKey = /2MM4ThCUi3SEckHKqduAK/I09gMXoPSQIQR0H63ZAw=
AllowedIPs = 0.0.0.0/0, ::/0
Endpoint = 45.77.30.118:51821
PersistentKeepalive = 25
EOF

      - name: ðŸ”Œ ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº VPN
        run: |
          sudo wg-quick up wg0

      - name: ðŸŒ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° IP Ñ‡ÐµÑ€ÐµÐ· VPN
        run: |
          sleep 3
          echo "IP Ñ‡ÐµÑ€ÐµÐ· VPN:"
          curl -s https://ipinfo.io/ip

      - name: âœ… ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¸Ð½Ð³Ð°
        run: |
          ping -c 4 1.1.1.1

      - name: ðŸ“´ ÐžÑ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ VPN
        if: always()
        run: |
          sudo wg-quick down wg0
